<<<<<<< HEAD
# -*- coding: utf-8 -*-
import re

from django import template
from django.utils.encoding import force_text

from crispy_forms.compatibility import text_type

try:
    from django.utils.functional import keep_lazy
except ImportError:
    # django < 1.10
    from django.utils.functional import allow_lazy
    # bare version for remove_spaces
    def keep_lazy(*args):
        def decorator(func):
            return allow_lazy(func, *args)
        return decorator
=======
import re

from django import template
from django.utils.encoding import force_str
from django.utils.functional import keep_lazy
>>>>>>> 82bd51fffd2fdb865204538b313e3f53fced89ea

register = template.Library()


<<<<<<< HEAD
@keep_lazy(text_type)
def remove_spaces(value):
    html = re.sub(r'>\s{3,}<', '> <', force_text(value))
    return re.sub(r'/><', r'/> <', force_text(html))
=======
@keep_lazy(str)
def remove_spaces(value):
    html = re.sub(r">\s{3,}<", "> <", force_str(value))
    return re.sub(r"/><", r"/> <", force_str(html))
>>>>>>> 82bd51fffd2fdb865204538b313e3f53fced89ea


class SpecialSpacelessNode(template.Node):
    def __init__(self, nodelist):
        self.nodelist = nodelist

    def render(self, context):
        return remove_spaces(self.nodelist.render(context).strip())


@register.tag
def specialspaceless(parser, token):
    """
    Removes whitespace between HTML tags, and introduces a whitespace
    after buttons an inputs, necessary for Bootstrap to place them
    correctly in the layout.
    """
<<<<<<< HEAD
    nodelist = parser.parse(('endspecialspaceless',))
=======
    nodelist = parser.parse(("endspecialspaceless",))
>>>>>>> 82bd51fffd2fdb865204538b313e3f53fced89ea
    parser.delete_first_token()

    return SpecialSpacelessNode(nodelist)
